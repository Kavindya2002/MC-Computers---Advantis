<div *ngIf="showPreview && invoice" class="invoice-preview-overlay">
  <div class="invoice-preview-container">
    <div class="preview-header">
      <h3 class="preview-title">Invoice Preview</h3>
      <div class="preview-actions">
        <button class="btn btn-primary me-2" (click)="generatePDF()">
          <i class="fas fa-download"></i> Download PDF
        </button>
        <button class="btn btn-info me-2" (click)="printInvoice()">
          <i class="fas fa-print"></i> Print
        </button>
        <button class="btn btn-secondary" (click)="closePreview()">
          <i class="fas fa-times"></i> Close
        </button>
      </div>
    </div>

    <div class="preview-content">
      <div id="invoice-preview" class="invoice-template">
        <!-- Invoice Header -->
        <div class="invoice-header">
          <div class="company-info">
            <img src="assets/logo.png" alt="MC Computers" class="invoice-logo">
            <div class="company-details">
              <h2>MC Computers</h2>
              <p class="tagline">YOUR TRUSTED TECH STORE</p>
              <p>123 Tech Avenue, Colombo 07, Sri Lanka</p>
              <p>+94 11 234 5678 | info&#64;mcccomputers.lk</p>
            </div>
          </div>
          <div class="invoice-title">
            <h1>INVOICE</h1>
          </div>
        </div>

        <!-- Invoice Details -->
        <div class="invoice-details">
          <div class="customer-info">
            <h4>BILLED TO:</h4>
            <p><strong>{{ invoice.customer.name }}</strong></p>
            <p>{{ invoice.customer.phone }}</p>
            <p *ngIf="invoice.customer.email">{{ invoice.customer.email }}</p>
            <p *ngIf="invoice.customer.address">{{ invoice.customer.address }}</p>
          </div>
          <div class="invoice-meta">
            <p><strong>Invoice No:</strong> {{ invoice.invoiceNumber }}</p>
            <p><strong>Date:</strong> {{ invoice.invoiceDate | date:'mediumDate' }}</p>
          </div>
        </div>

        <!-- Items Table -->
        <table class="invoice-table">
          <thead>
            <tr>
              <th>Item</th>
              <th>Description</th>
              <th>Qty</th>
              <th>Price</th>
              <th>Amount</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let item of invoice.items">
              <td>{{ item.productName }}</td>
              <td>{{ item.description }}</td>
              <td>{{ item.quantity }}</td>
              <td>${{ item.price }}</td>
              <td>${{ item.amount }}</td>
            </tr>
          </tbody>
        </table>

        <!-- Totals -->
        <div class="invoice-totals">
          <div class="totals-grid">
            <div class="total-row">
              <span>Subtotal:</span>
              <span>${{ invoice.subTotal.toFixed(2) }}</span>
            </div>
            <div class="total-row">
              <span>Discount:</span>
              <span>-${{ invoice.discount.toFixed(2) }}</span>
            </div>
            <div class="total-row grand-total">
              <span><strong>Total:</strong></span>
              <span><strong>${{ invoice.total.toFixed(2) }}</strong></span>
            </div>
          </div>
        </div>

        <!-- Footer -->
        <div class="invoice-footer">
          <div class="terms">
            <h5>Terms & Conditions</h5>
            <p>• All defective parts will be repaired within 14 days upon warranty claim submission.</p>
            <p>• Warranty does not cover chip burns, physical damage, corrosion, misuse, negligence, or software issues.</p>
            <p>• Please keep this invoice safe; it is required for all warranty claims and service requests.</p>
          </div>
          <div class="signatures">
            <div class="signature-box">
              <p>Authorized Signature</p>
              <div class="signature-line"></div>
            </div>
            <div class="signature-box">
              <p>Customer Signature</p>
              <div class="signature-line"></div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
